<!DOCTYPE HTML>
<html>
	<head>
		<title>Luis Alejandro Higuaran Serrano | :: Computación Visual ::</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />

		<!-- Code-Prettify -->
		<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

		<!-- P5.js -->
		<script src="p5/p5.min.js"></script>
		<script src="p5/addons/p5.sound.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/addons/p5.sound.min.js"></script> -->

		<!-- Ejemplos P5.js -->
		<script src="p5/js/software/filterGray.js"></script>

		<!-- Bootstrap CSS 
    	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">-->
	
		<!-- Favicon -->
		<link rel="icon" href="images/favicon.png" sizes="32x32" type="image/png">


	</head>
	<body class="subpage">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">
						<div class="row">
							<div class="col-12">

								<!-- Logo -->
									<h1><a href="index.html" id="logo">VISUAL COMPUTING</a></h1>

								<!-- Nav -->
									<nav id="nav">
										<a href="index.html">INICIO</a>
										<a href="Example1.html">EXAMPLES P5.JS</a>
										<a href="Ilussion1.html">ILLUSION</a>
										<a href="Software1.html">SOFTWARE P5.JS</a>
										<a href="Hardware1.html">HARDWARE P5.JS</a>
									</nav>

							</div>
						</div>
					</div>
				</section>

			<!-- Content -->
				<section id="content">
					<div class="container">
						<div class="row">
							<div class="col-12">

								<!-- Main Content -->
									<section>
										<header>
											<h2><a href="https://processing.org/tutorials/pshader/" target="_blank">HSL, HSV, HSB & RGB MODEL WITH VIDEO</a></h2>
											<h3>PROCESSING & HARDWARE -  P5.JS</h3>
										</header>
										<p>
											En esta publicación se desea mostrar los resultados obtenidos al realizar el procesamiento
											de imágenes y videos con shaders utilizando un leguaje de alto nivel, como lo es GLSL,
											para empezar a aprovechar las características de nuestro hardware y tener resultados
											muy favorables a nivel de máquina. El cambio y rendimiento, comparado con la velocidad
											de respuesta es notable en comparación con el procesamiento de imágenes y videos por medio de hardware.
										</p>

										<p>
											A continuación, se observará cómo se puede obtener una imagen y video a escala de grises
											a partir del Promedio de los componentes RGB de una imagen y el caculo del coeficiente
											Luma. Para ello este estudio está basado en la documentación
											<a href="https://en.wikipedia.org/wiki/HSL_and_HSV#Lightness" target="_blank">HSL AND HSV</a>
											, el tutorial de shaders del profesor <strong>Andres Colubri</strong> en el sitio web
											<a href="https://processing.org/tutorials/pshader/" target="_blank">processing.org</a>
											y el tutorial de la página
											<a href="https://itp-xstory.github.io/p5js-shaders/" target="_blank">itp-xstory.github.io</a>
											donde se explican conceptos básicos de shaders con p5.js. En gran medida la construcción
											de este programa está basado en el ejemplo
											<a href="Software1.html" target="_blank">HSL, HSV, HSB & RGB MODEL</a>
											del procesamiento de imágenes con software, ya que se manejan funciones y procedimientos
											muy similares, sin embargo, para facilitar el entendimiento de cómo funciona el
											procesamiento por hardware, hay que pensar que lo que hacíamos para uno solo pixel
											en software ahora lo vamos hacer al mismo tiempo para todos los pixeles.
										</p>

										<h4>Comandos</h4>

										<div class="table-wrapper text-center">
											<table>
												<thead>
													<tr>
														<th>Tecla</th>
														<th>Luminancia</th>
														<th>Expresión</th>
														<th>Imagen resultante</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td><img src="images/keyboard/0.png" style="width:40px;vertical-align: middle"/></td>
														<td>Original</td>
														<td><strong><i><img src="images/gray/equation0.png" style="height:20px;;vertical-align: middle"/></i></strong></td>
														<td><img src="images/gray/imgs0.png" style="width:130px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/1.png" style="width:40px;vertical-align: middle"/></td>
														<td>Media aritmética</td>
														<td><img src="images/gray/equation1.png" style="height:25px;;vertical-align: middle"/></td>
														<td><img src="images/gray/imgs1.png" style="width:130px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/2.png" style="width:40px;vertical-align: middle"/></td>
														<td>Componente más grande</td>
														<td><img src="images/gray/equation2.png" style="height:20px;;vertical-align: middle"/></td>
														<td><img src="images/gray/imgs2.png" style="width:130px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/3.png" style="width:40px;vertical-align: middle"/></td>
														<td>Rango medio</td>
														<td><img src="images/gray/equation3.png" style="height:25px;;vertical-align: middle"/></td>
														<td><img src="images/gray/imgs3.png" style="width:130px;vertical-align: middle"/></td>
													</tr>											
													<tr>
														<td><img src="images/keyboard/4.png" style="width:40px;vertical-align: middle"/></td>
														<td>Promedio ponderado Luma<h5>(SDTV)</h5></td>
														<td><img src="images/gray/equation4.png" style="height:18px;;vertical-align: middle"/></td>
														<td><img src="images/gray/imgs4.png" style="width:130px;vertical-align: middle"/></td>
													</tr>																				
												</tbody>
											</table>
										</div>
									
										<div class="canvasp5js" >
											<div>
												<p align="center">
													<!-- HTML slider-->
													<iframe src="p5/js/shaders/grayscale/index.html" style="position:relative;height:420px;width:920px"></iframe>
												</p>
											</div>
										</div>
										<p></p>
										<h4>p5*js Code</h4>

										<pre>
											<code class="prettyprint">									
let theShader;
let shaderTexture;
let img;
let cam;

let theShaderVideo;
let shaderVideo;
let video;

let angle=0;
let gray = 0;

function preload(){
	img = loadImage('https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Hawaii_turtle_2.JPG/640px-Hawaii_turtle_2.JPG');
	video = createVideo('https://d2v9y0dukr6mq2.cloudfront.net/video/preview/GTYSdDW/divers-watching-sea-turtle-swim-through-coral-reef_zksb-usls__PMNW.mp4');
	video.hide();
	// Cargar los shaders
	theShader = loadShader('texture.vert','texture.frag');
	theShaderVideo = loadShader('texture.vert','texture.frag');  
}

function setup() {
	pixelDensity(1);
	
	// Se requiere trabajar con WEBGL
	createCanvas(windowWidth, 400, WEBGL);
	noStroke();

	// inicializar la capa del createGraphics
	shaderTexture = createGraphics(512, 512, WEBGL);
	shaderVideo = createGraphics(windowWidth, windowHeight, WEBGL);
	
	// Quitar bordes en el createGraphics
	shaderTexture.noStroke();
	shaderVideo.noStroke();  
	
	video.loop();
}

function draw() {
	// Se pasa el shader a la capa del createGraphics
	shaderTexture.shader(theShader);
	shaderVideo.shader(theShaderVideo);

	// Valores uniform para el fragment shader
	theShader.setUniform("u_img", img);
	theShader.setUniform("u_key", gray);
	theShaderVideo.setUniform('u_img', video);
	theShaderVideo.setUniform('u_key', gray);
	
	// Renderizar el shader
	shaderTexture.rect(0,0,width,height);
	shaderVideo.rect(0,0,width,height);

	background(255);

	// Puntos de luz 
	pointLight(255, 255, 255, 0, 0, 500);
	// Efecto linterna
	let dx= mouseX-width/2;
	let dy= mouseY-height/2;
	pointLight(100,250,255,dx,dy,100);

	translate(0, 0, 0);
	push();
	//Se pasa el shader como textura
	texture(shaderTexture);
	translate(200, 0, 0);
	rotateZ(angle);
	rotateX(angle);
	rotateY(angle*2); 
	box(200);
	pop();
	
	// Rotacion de la caja
	angle += 0.002;
	
	push();
	// Se pasa la imagen original como textura
	texture(img);
	// Numero de puntas de la figura
	let ellipseFidelity = int(map(mouseX, 25, width, 8, 100));
	ellipse(-250, 0, 350, 350, ellipseFidelity);
	//plane(500,500);
	pop();
	
	push();
	//Se pasa el shader del video como textura
	texture(shaderVideo);
	translate(0, 0, -100);
	plane(900,500);
	pop();  
}

// Se ejecuta cuando se presiona cualquier tecla
function keyPressed() {
	if (key === '0') {
	gray = 0;
	} else if (key === '1') { 
	gray = 1;
	} else if (key === '2') {
	gray = 2;
	} else if (key === '3') {
	gray = 3;
	} else if (key === '4') {
	gray = 4;
	}
}

function windowResized(){
	resizeCanvas(windowWidth, windowHeight);
}</code></pre>

<h4>Vertex Code</h4>
									<pre><code class="prettyprint">attribute vec3 aPosition;
attribute vec2 aTexCoord;

// Obtener texcoords
varying vec2 vTexCoord;

void main() {

	// Copia los texcoords
	vTexCoord = aTexCoord;
	// Copia la poscicion de los datos en vec4, usando 1.0 como el componente w
	vec4 positionVec4 = vec4(aPosition, 1.0);

	// Escala la posicion por dos y la mueve al centro de la pantalla
	positionVec4.xy = positionVec4.xy * 2.0 - 1.0;

	// Envia la informacion del vertex al fragment shader
	gl_Position = positionVec4;
}</code></pre>

<h4>Fragment Code</h4>
									<pre><code class="prettyprint">// Estas son definiciones necesarias que le permiten a la tarjeta gráfica saber cómo representar el sombreador
#ifdef GL_ES
precision mediump float;
#endif
	
	varying vec2 vTexCoord;
	// Valores que se pasan desde p5
	uniform sampler2D u_img;
	uniform int u_key;

// Funcion para convertir un color a escala de grises
float grayscale(vec3 color) {
	float lightness;
	
	if (u_key==1){
		float I=(color.r + color.g + color.b) / 3.0; // Promedio de los tres componentes
		lightness = I;
	} else if (u_key==2){
		float V= max(max(color.r,color.g),color.b); // Componente mas grande de un color
		lightness = V;
	} else if (u_key==3){
		float L=(max(max(color.r,color.g),color.b)+min(min(color.r,color.g),color.b))/2.0; // Promedio entre el componente mas grande y el mas pequeño
		lightness = L;
	} else if (u_key==4){ // Promedio ponderado de RGB con corrección gamma (Luma)
		float Y= dot(color, vec3(0.299, 0.587, 0.114)); // SDTV
		lightness = Y;
	}
	return lightness;
}

void main() {
	vec2 uv = vTexCoord;

	//Invierte la posicion de la cordenada  para que la imagen no quede alrreves
	uv.y = 1.0 - uv.y;

	vec4 tex = texture2D(u_img, uv);
	// Escala de grises
	float gray =grayscale(tex.rgb);
	
	float threshR = gray ;
	float threshG = gray ;
	float threshB = gray ;
	
	if (u_key==0){
	threshR = tex.r ;
	threshG = tex.g ;
	threshB = tex.b ;
	}
	vec3 thresh = vec3(threshR, threshG, threshB);

	// Render de la salida
	gl_FragColor = vec4(thresh, 1.0);
}
	</code>
</pre>
										<!-- Pagination -->
										<div class="pagination">
											<a href="#" class="button-large disable">Previous Page</a>
											<a href="Hardware2.html" target="_parent" class="button-large">Next Page</a>
										</div>
									</section>
							</div>
						</div>
					</div>
				</section>

			<!-- Footer -->
				<section id="footer">
					<div class="container">
						<div class="row">
							<div class="col-8 col-12-medium">

								<!-- Links -->
									
									<section>
										<!--
										<h2>Links to Important Stuff</h2>
										<div>
											<div class="row">
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
											</div>
										</div>
										-->
									</section>

							</div>
							<div class="col-4 col-12-medium imp-medium">

								<!-- Blurb -->
									<section>
										<!--
										<h2>An Informative Text Blurb</h2>
										<p>
											Duis neque nisi, dapibus sed mattis quis, rutrum accumsan sed. Suspendisse eu
											varius nibh. Suspendisse vitae magna eget odio amet mollis. Duis neque nisi,
											dapibus sed mattis quis, sed rutrum accumsan sed. Suspendisse eu varius nibh
											lorem ipsum amet dolor sit amet lorem ipsum consequat gravida justo mollis.
										</p>
										-->
									</section>

							</div>
						</div>
					</div>
				</section>

			<!-- Copyright -->
				<div id="copyright">
					&copy; Untitled. All rights reserved. | Design: <a href="http://html5up.net">HTML5 UP</a>
				</div>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>