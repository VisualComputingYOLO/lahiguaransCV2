<!DOCTYPE HTML>
<html>
	<head>
		<title>Luis Alejandro Higuaran Serrano | :: Computación Visual ::</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />

		<!-- Code-Prettify -->
		<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

		<!-- P5.js -->
		<script src="p5/p5.min.js"></script>
		<script src="p5/addons/p5.sound.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/addons/p5.sound.min.js"></script> -->

		<!-- Ejemplos P5.js -->
		<script src="p5/js/software/maskGrayVideo.js"></script>

		<!-- Bootstrap CSS 
    	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">-->
	
		<!-- Favicon -->
		<link rel="icon" href="images/favicon.png" sizes="32x32" type="image/png">


	</head>
	<body class="subpage">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">
						<div class="row">
							<div class="col-12">

								<!-- Logo -->
									<h1><a href="index.html" id="logo">VISUAL COMPUTING</a></h1>

								<!-- Nav -->
									<nav id="nav">
										<a href="index.html">INICIO</a>
										<a href="Example1.html">EXAMPLES P5.JS</a>
										<a href="Ilussion1.html">ILLUSION</a>
										<a href="Light1.html">LIGHT</a>
										<a href="Software1.html">SOFTWARE P5.JS</a>
										<a href="Hardware1.html">HARDWARE P5.JS</a>
										<a href="project1.html">PROJECT P5.JS</a>
									</nav>

							</div>
						</div>
					</div>
				</section>

			<!-- Content -->
				<section id="content">
					<div class="container">
						<div class="row">
							<div class="col-12">

								<!-- Main Content -->
									<section>
										<header>
											<h2><a href="https://processing.org/tutorials/video/" target="_blank">VIDEO PROCESSING</a></h2>
											<h3>PROCESSING & SOFTWARE -  P5.JS</h3>
										</header>
										<p>
											Al igual que en el estudio de procesamiento de imágenes, que se vio los ejemplos
											<a href="Software1.html" target="_blank">HSL, HSV, HSB & RGB MODEL</a>
											y
											<a href="Software2.html" target="_blank">KERNEL</a>
											, se realizó la siguiente implementación que muestra cómo realizar el procesamiento
											de videos. Para este fin se crearon dos lienzos, el primero permite visualizar el
											video original que es capturado directamente de la webcam que tenga conectada a su
											dispositivo <strong>(permitir acceder a la cámara desde el navegador)</strong>,
											de manera similar a la que se explica en la documentación de
											<a href="https://processing.org/tutorials/video/" target="_blank">processing.org</a>
											y, el segundo lienzo se encarga de mostrar los cambios que se le realizan en tiempo
											real dependiendo de las teclas que se presionen, según la tabla de comandos por teclado.
										</p>

										<p>
											Este programa muestra los cambios al aplicar diferentes escalas de grises, máscaras
											de convolución y el complementario de una imagen, utilizando los mismos algoritmos
											que permitieron realizar el procesamiento de imágenes en los ejemplos descritos 
											anteriormente, pero esta vez modificando los pixeles de una imagen capturada por video.
										</p>

										<h4>Comandos</h4>

										<div class="table-wrapper text-center">
											<table>
												<thead>
													<tr>
														<th>Tecla</th>
														<th>Operación</th>
														<th>Expresión</th>
														<th>Video resultante</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td><img src="images/keyboard/0.png" style="width:40px;vertical-align: middle"/></td>
														<td>Identidad</td>
														<td><img src="images/matrix/matrix0.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/gray/vid0.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/1.png" style="width:40px;vertical-align: middle"/></td>
														<td>Acentuar los bordes<h5>(Máscara de Convolución)</h5></td>
														<td><img src="images/matrix/matrix1.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/matrix/vid1.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/2.png" style="width:40px;vertical-align: middle"/></td>
														<td>Repujado<h5>(Máscara de Convolución)</h5></td>
														<td><img src="images/matrix/matrix2.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/matrix/vid2.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/3.png" style="width:40px;vertical-align: middle"/></td>
														<td>Detección de bordes<h5>(Máscara de Convolución)</h5></td>
														<td><img src="images/matrix/matrix3.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/matrix/vid3.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>											
													<tr>
														<td><img src="images/keyboard/4.png" style="width:40px;vertical-align: middle"/></td>
														<td>Detección de bordes<h5>(Máscara de Convolución)</h5></td>
														<td><img src="images/matrix/matrix4.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/matrix/vid4.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/5.png" style="width:40px;vertical-align: middle"/></td>
														<td>Detección de bordes<h5>(Máscara de Convolución)</h5></td>
														<td><img src="images/matrix/matrix5.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/matrix/vid5.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/6.png" style="width:40px;vertical-align: middle"/></td>
														<td>Enfocar<h5>(Máscara de Convolución)</h5></td>
														<td><img src="images/matrix/matrix6.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/matrix/vid6.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/7.png" style="width:40px;vertical-align: middle"/></td>
														<td>Desenfoque de cuadro<h5>(Máscara de Convolución)</h5></td>
														<td><img src="images/matrix/matrix7.png" style="width:150px;vertical-align: middle"/></td>
														<td><img src="images/matrix/vid7.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>		
													<tr>
														<td><img src="images/keyboard/a.png" style="width:40px;vertical-align: middle"/></td>
														<td>Media aritmética<h5>(Escala de Grises)</h5></td>
														<td><img src="images/gray/equation1.png" style="height:25px;;vertical-align: middle"/></td>
														<td><img src="images/gray/vid1.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/b.png" style="width:40px;vertical-align: middle"/></td>
														<td>Componente más grande<h5>(Escala de Grises)</h5></td>
														<td><img src="images/gray/equation2.png" style="height:20px;;vertical-align: middle"/></td>
														<td><img src="images/gray/vid2.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/c.png" style="width:40px;vertical-align: middle"/></td>
														<td>Rango medio<h5>(Escala de Grises)</h5></td>
														<td><img src="images/gray/equation3.png" style="height:25px;;vertical-align: middle"/></td>
														<td><img src="images/gray/vid3.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/d.png" style="width:40px;vertical-align: middle"/></td>
														<td>Promedio ponderado Luma<h5>(Escala de Grises SDTV)</h5></td>
														<td><img src="images/gray/equation4.png" style="height:18px;;vertical-align: middle"/></td>
														<td><img src="images/gray/vid4.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/x.png" style="width:40px;vertical-align: middle"/></td>
														<td>Imagen Opuesta<h5>(Colores Complementarios)</h5></td>
														<td><strong><i><h2 style="display:inline">255 -</h2> <img src="images/gray/equation0.png" style="height:20px;;vertical-align: middle"/></i></strong></td>
														<td><img src="images/complementary/vid1.gif" style="width:190px;vertical-align: middle"/></td>
													</tr>											
												</tbody>
											</table>
										</div>

										<div class="canvasp5js" >
											<div>
												<div id="maskGrayVideo"></div>												
											</div>
										</div>
										<p></p>
										<h4>p5*js Code</h4>

										<pre>
											<code class="prettyprint">									
let value; // Permite escoger que filtro se va a realizar
let matrixsize; // Tamaño de la matriz
var matrix; // Matriz de convoluciones     

let canvas_01;
let canvas_02;

var widthI = 500;   // Anchura del lienzo
var heightI = 500;  // Altura del lienzo

function preload() {
	img_01 = createCapture(VIDEO);
	img_02 = createCapture(VIDEO);
	img_01.hide();
	img_02.hide();
}

function setup() {
	var myCanvas = createCanvas(widthI*2+20, heightI);
	myCanvas.parent('maskGrayVideo'); 

	canvas_01 = createGraphics(widthI, heightI);
	canvas_02 = createGraphics(widthI, heightI);
}

function draw(){
	drawCanvas_01();
	drawCanvas_02();
	
	selectValue();

	image(canvas_01, 0, 0);
	image(canvas_02, widthI+10, 0);
}

function keyPressed(){
	matrixsize = 3;

	switch(key) {
		case 'a':
			value = 1;
			break;
		case 'b':
			value = 2;
			break;
		case 'c':
			value = 3;
			break;
		case 'd':
			value = 4;
			break;
		case 'e':
			value = 5;
			break;
		case 'f':
			value = 6;
			break;
		case 'g':
			value = 7;
			break;
		case 'x':
			value = 'c';
			break;
		case '0':   // Identidad
			value = 10;
			matrix = [ [  0,  0,  0 ],
						[  0,  1,  0 ],
						[  0,  0,  0 ] ]; 
			break;
		case '1':   // Enfocar. Acentúa los bordes
			value = 11;
			matrix = [ [ -1, -1, -1 ],
						[ -1,  9, -1 ],
						[ -1, -1, -1 ] ]; 
			break;
		case '2':   // Repujado
			matrix = [ [ -2, -1,  0 ],
						[ -1,  1,  1 ],
						[  0,  1,  2 ] ]; 
			value = 12;
			break;
		case '3':   // Detección de bordes
			matrix = [ [  1,  0, -1 ],
						[  0,  0,  0 ],
						[ -1,  0,  1 ] ]; 
			value = 13;
			break;
		case '4':
			matrix = [ [  0,  1,  0 ],
						[  1, -4,  1 ],
						[  0,  1,  0 ] ]; 
			value = 14;
			break;
		case '5':
			matrix = [ [ -1, -1, -1 ],
						[ -1,  8, -1 ],
						[ -1, -1, -1 ] ];
			value = 15;
			break;
		case '6':   // Enfocar
			matrix = [ [  0, -1,  0 ],
						[ -1,  5, -1 ],
						[  0, -1,  0 ] ];
			value = 16;
			break;
		case '7':   // Desenfoque de cuadro (normalizado)
			matrix = [ [ 1/9, 1/9, 1/9 ],
						[ 1/9, 1/9, 1/9 ],
						[ 1/9, 1/9, 1/9 ] ]; 
			value = 17;
			break;
		case '8':   // Desenfoque gaussiano 5 × 5 (aproximación)
			matrixsize = 5;
			matrix = [ [ 1/256,  4/256,  6/256,  4/256, 1/256 ],
						[ 4/256, 16/256, 24/256, 16/256, 4/256 ],
						[ 6/256, 24/256, 36/256, 24/256, 6/256 ],
						[ 4/256, 16/256, 24/256, 16/256, 4/256 ],
						[ 1/256,  4/256,  6/256,  4/256, 1/256 ] ];
			value = 18;
			break;
		case '9':   // Máscara de desenfoque 5 × 5 (sin máscara de imagen)
			matrixsize = 5;
			matrix = [ [ -1/256,  -4/256,  -6/256,  -4/256, -1/256 ],
						[ -4/256, -16/256, -24/256, -16/256, -4/256 ],
						[ -6/256, -24/256, 476/256, -24/256, -6/256 ],
						[ -4/256, -16/256, -24/256, -16/256, -4/256 ],
						[ -1/256,  -4/256,  -6/256,  -4/256, -1/256 ] ];
			value = 19;
			break;
		default:
			break;
	}
}

// Funciones Disenadas
const drawCanvas_01 = ()=>{ // Pone el primer video en el lienzo 1
	canvas_01.image(img_01, 0, 0);
}

const drawCanvas_02 = ()=>{ // Pone el segundo video en el lienzo 2
	canvas_02.image(img_02, 0, 0);
}

const selectValue = ()=>{ // Selecciona el filtro a utilizar dependiendo del valor que tenga value
	if ( 0 < value && value <10 ) {
		filtrosBlancoNegro(value);
	} else if(value === 'c') {
		complementary();
	} else if(value > 10) {
		convolutions();
	}
}

const filtrosBlancoNegro = (gray)=>{ // Escala de grises
	let lightness = 210;
	img_02.loadPixels();

	for (let y = 0; y < img_02.height; y++) {
		for (let x = 0; x < img_02.width; x++){ 
			let index = (x+y*img_02.width)*4; // Posicion del pixel
			
			let r=img_02.pixels[index+0]; // Componente Red
			let g=img_02.pixels[index+1]; // Componente Green
			let b=img_02.pixels[index+2]; // Componente Blue
			let a=img_02.pixels[index+3]; // Componente Alpha
			
			if (gray===1){
				let I=(r+g+b)/3; // Promedio de los tres componentes
				lightness = I;
			} else if (gray===2){
				let V= max(r,g,b); // Componente mas grande de un color
				lightness = V;
			} else if (gray===3){
				let L=(max(r,g,b)+min(r,g,b))/2; // Promedio entre el componente mas grande y el mas pequeño
				lightness = L;
			} else if (gray===4){ // Promedio ponderado de RGB con corrección gamma (Luma)
				let Y601= 0.2989*r + 0.5870*g + 0.1140*b; // SDTV
				lightness = Y601;
			} else if (gray===5){ 
				let Y240= 0.212*r + 0.701*g + 0.087*b; // Adobe
				lightness = Y240;
			} else if (gray===6){ 
				let Y709= 0.2126*r + 0.7152*g + 0.0722*b; // HDTV
				lightness = Y709;
			} else if (gray===7){ 
				let Y2020= 0.2627*r + 0.6780*g + 0.0593*b; // UHDTV,HDR
				lightness = Y2020;
			} 

			img_02.pixels[index+0]=lightness;
			img_02.pixels[index+1]=lightness;
			img_02.pixels[index+2]=lightness;
			img_02.pixels[index+3]=a;
			
			if (gray===0){ // Imagen original
				pixels[index+0]=r;
				pixels[index+1]=g;
				pixels[index+2]=b;
				pixels[index+3]=a;
			}
		}
	}
	img_02.updatePixels();
}

const complementary = ()=>{ // Colores opuestos
	//let img2 = createImage(512, 550);
	img_02.loadPixels();

	for(var y = 0 ; y < img_02.height; y++) {
		for(var x = 0; x < img_02.width; x++) {
			let index = (x + y * img_02.width) * 4;

			img_02.pixels[index + 0] = 255 - img_02.pixels[index + 0];
			img_02.pixels[index + 1] = 255 - img_02.pixels[index + 1];
			img_02.pixels[index + 2] = 255 - img_02.pixels[index + 2];
		}
	}
	img_02.updatePixels();
}

const convolutions = ()=>{ // Mascara de convoluciones
	img_02.loadPixels();

	for (let x = 0; x < img_02.width; x++) {
		for (let y = 0; y < img_02.height; y++ ) { 
			let c = convolutionAux(x, y, matrix, matrixsize, img_02);
			let loc = (x + y*img_02.width)*4;

			img_02.pixels[loc] = red(c);
			img_02.pixels[loc+1] = green(c);
			img_02.pixels[loc+2] = blue(c);
			img_02.pixels[loc+3] = alpha(c);
		}
	}    
	img_02.updatePixels();
}

const convolutionAux = (x, y, matrix, matrixsize, img)=>{
	var rtotal = 0;
	var gtotal = 0
	var btotal = 0;
	var atotal = 0;

	for (let i = 0; i < matrixsize; i++){
		for (let j= 0; j < matrixsize; j++){
			var xloc = x+i;
			var yloc = y+j;
			var loc = (xloc + img.width*yloc)*4;

			loc = constrain(loc,0,img.pixels.length-1);
			rtotal += ((img.pixels[loc+0]) * matrix[i][j]);
			gtotal += ((img.pixels[loc+1]) * matrix[i][j]);
			btotal += ((img.pixels[loc+2]) * matrix[i][j]);
			atotal += ((img.pixels[loc+3]) * matrix[i][j]);
		}
	}
	// Restringir el rango de los valores RGBA
	rtotal = constrain(rtotal, 0, 255);
	gtotal = constrain(gtotal, 0, 255);
	btotal = constrain(btotal, 0, 255);
	atotal = constrain(atotal, 0, 255);
	// Retorna el color resultante
	return color(rtotal, gtotal, btotal);
}
											</code>
										</pre>
										<!-- Pagination -->
										<div class="pagination">
											<a href="Software3.html" class="button-large">Previous Page</a>
											<a href="Software5.html" target="_parent" class="button-large">Next Page</a>
										</div>
									</section>
							</div>
						</div>
					</div>
				</section>

			<!-- Footer -->
				<section id="footer">
					<div class="container">
						<div class="row">
							<div class="col-8 col-12-medium">

								<!-- Links -->
									
									<section>
										<!--
										<h2>Links to Important Stuff</h2>
										<div>
											<div class="row">
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
											</div>
										</div>
										-->
									</section>

							</div>
							<div class="col-4 col-12-medium imp-medium">

								<!-- Blurb -->
									<section>
										<!--
										<h2>An Informative Text Blurb</h2>
										<p>
											Duis neque nisi, dapibus sed mattis quis, rutrum accumsan sed. Suspendisse eu
											varius nibh. Suspendisse vitae magna eget odio amet mollis. Duis neque nisi,
											dapibus sed mattis quis, sed rutrum accumsan sed. Suspendisse eu varius nibh
											lorem ipsum amet dolor sit amet lorem ipsum consequat gravida justo mollis.
										</p>
										-->
									</section>

							</div>
						</div>
					</div>
				</section>

			<!-- Copyright -->
				<div id="copyright">
					&copy; Untitled. All rights reserved. | Design: <a href="http://html5up.net">HTML5 UP</a>
				</div>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>