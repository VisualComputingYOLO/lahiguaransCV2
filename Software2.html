<!DOCTYPE HTML>
<html>
	<head>
		<title>Luis Alejandro Higuaran Serrano | :: Computación Visual ::</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />

		<!-- Code-Prettify -->
		<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

		<!-- P5.js -->
		<script src="p5/p5.min.js"></script>
		<script src="p5/addons/p5.sound.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/addons/p5.sound.min.js"></script> -->

		<!-- Ejemplos P5.js -->
		<script src="p5/js/software/masksImg.js"></script>

		<!-- Bootstrap CSS 
    	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">-->
	
		<!-- Favicon -->
		<link rel="icon" href="images/favicon.png" sizes="32x32" type="image/png">


	</head>
	<body class="subpage">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">
						<div class="row">
							<div class="col-12">

								<!-- Logo -->
									<h1><a href="index.html" id="logo">VISUAL COMPUTING</a></h1>

								<!-- Nav -->
									<nav id="nav">
										<a href="index.html">INICIO</a>
										<a href="Example1.html">EXAMPLES P5.JS</a>
										<a href="Ilussion1.html">ILLUSION</a>
										<a href="Light1.html">LIGHT</a>
										<a href="Software1.html">SOFTWARE P5.JS</a>
										<a href="Hardware1.html">HARDWARE P5.JS</a>
										<a href="project1.html">PROJECT P5.JS</a>
									</nav>

							</div>
						</div>
					</div>
				</section>

			<!-- Content -->
				<section id="content">
					<div class="container">
						<div class="row">
							<div class="col-12">

								<!-- Main Content -->
									<section>
										<header>
											<h2><a href="https://en.wikipedia.org/wiki/Kernel_(image_processing)" target="_blank">KERNEL</a></h2>
											<h3>PROCESSING & SOFTWARE -  P5.JS</h3>
										</header>
										<p>
											En la presente publicación se expone la forma en que se aplican los diferentes tipos
											de convolución en el procesamiento de imágenes, por medio de cálculos matemáticos
											realizados a cada uno de los pixeles y a los que lo rodean en su vecindario.
										</p>

										<p>
											El siguiente programa realiza la multiplicación de cada uno de los píxeles circundantes
											con una matriz llamada kernel o núcleo, como se vio en la documentación
											<a href="https://en.wikipedia.org/wiki/Kernel_(image_processing)#Details" target="_blank">KERNEL (image processing)</a>
											, que contiene diferentes valores predeterminados para aplicar correctamente las diferentes
											máscaras de convolución. El resultado de cada una de estas multiplicaciones se suman y
											este valor final  es asignado a cada uno de los componentes RGB del nuevo píxel.
										</p>

										<p>
											También es importante resaltar la gran importancia de la implementación de las máscaras
											de convolución ya que muchas de ellas son utilizados en la medicina para detectar cambios
											importantes o anomalías que no deberían tener el cuerpo, por ejemplo  podemos rescatar
											la máscara de convolución de Frei-Chen, Robinson y Kirsch utilizadas para la detección de
											cambios en las propiedades de un material, discontinuaciones en la superficie, entre
											otras más, como se profundiza en la 
											<a href="http://support.ptc.com/help/mathcad/en/index.html#page/PTC_Mathcad_Help%2Fconvolution_edge_finders.html%23" target="_blank">DOCUMENTACIÓN</a>.
										</p>

										<h4>Comandos</h4>

										<div class="table-wrapper text-center">
											<table>
												<thead>
													<tr>
														<th>Tecla</th>
														<th>Operación</th>
														<th>Kernel (Núcleo)</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td><img src="images/keyboard/0.png" style="width:40px;vertical-align: middle"/></td>
														<td>Identidad</td>
														<td><img src="images/KERNEL/matrix0.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img0.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/1.png" style="width:40px;vertical-align: middle"/></td>
														<td>Acentuar los bordes</td>
														<td><img src="images/KERNEL/matrix1.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img1.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/2.png" style="width:40px;vertical-align: middle"/></td>
														<td>Repujado</td>
														<td><img src="images/KERNEL/matrix2.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img2.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/3.png" style="width:40px;vertical-align: middle"/></td>
														<td>Detección de bordes</td>
														<td><img src="images/KERNEL/matrix3.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img3.png" style="width:100px;vertical-align: middle"/></td>
													</tr>											
													<tr>
														<td><img src="images/keyboard/4.png" style="width:40px;vertical-align: middle"/></td>
														<td>Detección de bordes</td>
														<td><img src="images/KERNEL/matrix4.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img4.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/5.png" style="width:40px;vertical-align: middle"/></td>
														<td>Detección de bordes</td>
														<td><img src="images/KERNEL/matrix5.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img5.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/6.png" style="width:40px;vertical-align: middle"/></td>
														<td>Enfocar</td>
														<td><img src="images/KERNEL/matrix6.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img6.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/7.png" style="width:40px;vertical-align: middle"/></td>
														<td>Desenfoque de cuadro<h5>(normalizado)</h5></td>
														<td><img src="images/KERNEL/matrix7.png" style="width:150px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img7.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/8.png" style="width:40px;vertical-align: middle"/></td>
														<td>Desenfoque gaussiano 5 × 5<h5>(aproximación)</h5></td>
														<td><img src="images/KERNEL/matrix8.png" style="width:150px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img8.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/9.png" style="width:40px;vertical-align: middle"/></td>
														<td>Máscara de desenfoque 5 × 5<h5>(sin máscara de imagen)</h5></td>
														<td><img src="images/KERNEL/matrix9.png" style="width:150px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img9.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/s.png" style="width:40px;vertical-align: middle"/></td>
														<td>Operador de Sobel</td>
														<td><img src="images/KERNEL/matrix11.png" style="width:160px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img11.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/p.png" style="width:40px;vertical-align: middle"/></td>
														<td>Operador de Prewitt</td>
														<td><img src="images/KERNEL/matrix12.png" style="width:150px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img12.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/f.png" style="width:40px;vertical-align: middle"/></td>
														<td>Operador de Frei-Chen</td>
														<td><img src="images/KERNEL/matrix13.png" style="width:150px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img13.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/r.png" style="width:40px;vertical-align: middle"/></td>
														<td>Operador de Robinson</td>
														<td><img src="images/KERNEL/matrix14.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img14.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
													<tr>
														<td><img src="images/keyboard/k.png" style="width:40px;vertical-align: middle"/></td>
														<td>Operador de Kirsch</td>
														<td><img src="images/KERNEL/matrix15.png" style="width:100px;vertical-align: middle"/></td>
														<td><img src="images/KERNEL/img15.png" style="width:100px;vertical-align: middle"/></td>
													</tr>
												</tbody>
											</table>
										</div>

										<div class="canvasp5js" >
											<div>
												<div id="masksImg"></div>												
											</div>
										</div>
										<p></p>
										<h4>p5*js Code</h4>

										<pre>
											<code class="prettyprint">									
var w = 60;
var K= 2;

var lienzo_01;
var lienzo_02;
var img_01;
var img_02;

let matrixsize = 3;
var matrix = [ [  0,  0,  0 ],
				[  0,  1,  0 ],
				[  0,  0,  0 ] ];
var title = 'IDENTIDAD';


function setup() { 
	var myCanvas = createCanvas(1000, 600);
	myCanvas.parent('masksImg');
	background(210);
	pixelDensity();
	img = loadImage('https://cors-anywhere.herokuapp.com/https://www.discovertravelnews.com/wp-content/uploads/2020/07/Moscu_San-Basilio-1300x731.jpg');
	textSize(18);
	stroke(255,255,128);
	textStyle(BOLDITALIC);
	textAlign(CENTER);
} 

function draw() {
	drawImage();
	image(img, 12, 12, img.width * (250 / img.width), img.height * (250 / img.width));
	text(title, width/2, 20);
}

// Dibuja la imagen de la Derecha
function drawImage() {

	img.resize(width,height * 1.05)
	loadPixels();
	img.loadPixels();
	let imgcopy = createImage(img.width, img.height);
	imgcopy.loadPixels();

	for (let x = 0; x < width; x++) {
		for (let y = 0; y < height; y++ ) { 
			let c = convolution(x, y, matrix, matrixsize, img); 
			let loc = (x + y*img.width)*4;

			imgcopy.pixels[loc] = red(c);
			imgcopy.pixels[loc+1] = green(c);
			imgcopy.pixels[loc+2] = blue(c);
			imgcopy.pixels[loc+3] = alpha(c);
		}
	}
	
	imgcopy.updatePixels();
	image(imgcopy, 0, 0); 
}

function convolution(x, y, matrix, matrixsize, img){
	//img.loadPixels();
	var rtotal = 0;
	var gtotal = 0;
	var btotal = 0;
	var atotal = 0;
	for (let i = 0; i < matrixsize; i++){
		for (let j= 0; j < matrixsize; j++){
			// What pixel are we testing
			var xloc = x+i;
			var yloc = y+j;
			var loc = (xloc + img.width*yloc)*4;

			// Make sure we haven't walked off our image, we could do better here
			loc = constrain(loc,0,img.pixels.length-1);
			// Calculate the convolution
			rtotal += ((img.pixels[loc]) * matrix[i][j]);
			gtotal += ((img.pixels[loc+1]) * matrix[i][j]);
			btotal += ((img.pixels[loc+2]) * matrix[i][j]);
			atotal += ((img.pixels[loc+3]) * matrix[i][j]);
		}
	}

	// Make sure RGB is within range
	rtotal = constrain(rtotal, 0, 255);
	gtotal = constrain(gtotal, 0, 255);
	btotal = constrain(btotal, 0, 255);
	atotal = constrain(atotal, 0, 255);
	// Return the resulting color
	return color(rtotal, gtotal, btotal);
}
// Se ejecuta cuando se presiona cualquier tecla
function keyPressed() {
	matrixsize = 3;
	if (key === '0') { // Identidad
	matrix = [ [  0,  0,  0 ],
				[  0,  1,  0 ],
				[  0,  0,  0 ] ]; 
				title = 'IDENTIDAD';
	} else if (key === '1') { // Enfocar. Acentúa los bordes
	matrix = [ [ -1, -1, -1 ],
				[ -1,  9, -1 ],
				[ -1, -1, -1 ] ]; 
				title = 'ACENTUAR BORDES';
	} else if (key === '2') { // Repujado
	matrix = [ [ -2, -1,  0 ],
				[ -1,  1,  1 ],
				[  0,  1,  2 ] ]; 
				title = 'REPUJADO';
	} else if (key === '3') { // Detección de bordes
	matrix = [ [  1,  0, -1 ],
				[  0,  0,  0 ],
				[ -1,  0,  1 ] ]; 
				title = 'DETECCIÓN DE BORDES';
	} else if (key === '4') {
	matrix = [ [  0,  1,  0 ],
				[  1, -4,  1 ],
				[  0,  1,  0 ] ]; 
				title = 'DETECCIÓN DE BORDES';
	} else if (key === '5') {
	matrix = [ [ -1, -1, -1 ],
				[ -1,  8, -1 ],
				[ -1, -1, -1 ] ]; 
				title = 'DETECCIÓN DE BORDES';
	} else if (key === '6') { // Enfocar
	matrix = [ [  0, -1,  0 ],
				[ -1,  5, -1 ],
				[  0, -1,  0 ] ];
				title = 'ENFOCAR';
	} else if (key === '7') { // Desenfoque de cuadro (normalizado)
	matrix = [ [ 1/9, 1/9, 1/9 ],
				[ 1/9, 1/9, 1/9 ],
				[ 1/9, 1/9, 1/9 ] ]; 
				title = 'DESENFOQUE DE CUADRO';
	} else if (key === '8') { // Desenfoque gaussiano 5 × 5 (aproximación)
	matrixsize = 5;
	matrix = [ [ 1/256,  4/256,  6/256,  4/256, 1/256 ],
				[ 4/256, 16/256, 24/256, 16/256, 4/256 ],
				[ 6/256, 24/256, 36/256, 24/256, 6/256 ],
				[ 4/256, 16/256, 24/256, 16/256, 4/256 ],
				[ 1/256,  4/256,  6/256,  4/256, 1/256 ] ];
				title = 'DESENFOQUE GAUSSIANO';
	} else if (key === '9') { // Máscara de desenfoque 5 × 5 (sin máscara de imagen)
	matrixsize = 5;
	matrix = [ [ -1/256,  -4/256,  -6/256,  -4/256, -1/256 ],
				[ -4/256, -16/256, -24/256, -16/256, -4/256 ],
				[ -6/256, -24/256, 476/256, -24/256, -6/256 ],
				[ -4/256, -16/256, -24/256, -16/256, -4/256 ],
				[ -1/256,  -4/256,  -6/256,  -4/256, -1/256 ] ];
				title = 'MÁSCARA DE DESENFOQUE';
	} else if (key === 's') { // Operador de Sobel
	let x = [ [  1/4,  0/4, -1/4 ],
				[  2/4,  0/4, -2/4 ],
				[  1/4,  0/4, -1/4 ] ];
				
	let y = [ [ -1/4, -2/4, -1/4 ],
				[  0/4,  1/4,  0/4 ],
				[  1/4,  2/4,  1/4 ] ];
	matrix = x;
				for (let i = 0; i < matrixsize; i++){
				for (let j= 0; j < matrixsize; j++){
					matrix[i][j]=atan(x[i][j]/y[i][j]);
					}
				}				
				title = 'OPERADOR DE SOBEL';
	} else if (key === 'p') { // Operador de Prewitt
	let x = [ [ -1,  0,  1 ],
				[ -1,  0,  1 ],
				[ -1,  0,  1 ] ];
				
	let y = [ [  1,  1,  1 ],
				[  0,  0,  0 ],
				[ -1, -1, -1 ] ];
	matrix=x;
				for (let i = 0; i < matrixsize; i++){
				for (let j= 0; j < matrixsize; j++){
					matrix[i][j]=x[i][j]+y[i][j];
					}
				}
				title = 'OPERADOR DE PREWITT';
	} else if (key === 'f') { // Operador de Frei-Chen
	let x = [ [  1,        0,       -1 ],
				[  sqrt(2),  0, -sqrt(2) ],
				[  1,        0,       -1 ] ];
				
	let y = [ [  1,  sqrt(2),  1 ],
				[  0,        0,  0 ],
				[ -1, -sqrt(2), -1 ] ];
	
	let z = [ [ -1,  0,  1 ],
				[  0,  0,  0 ],
				[  1,  0, -1 ] ];
	matrix=x;
				for (let i = 0; i < matrixsize; i++){
				for (let j= 0; j < matrixsize; j++){
					matrix[i][j]=x[i][j]+y[i][j]+z[i][j];
					}
				}
				title = 'OPERADOR DE FREI-CHEN';
	} else if (key === 'r') { // Operador de Robinson
	matrix = [ [ -1,  0, 1 ],
				[ -2,  0, 2 ],
				[ -1,  0, 1 ] ];
				title = 'OPERADOR DE ROBINSON';
	} else if (key === 'k') { // Operador de Kirsch
	matrix = [ [ -3, -3,  5 ],
				[ -3,  0,  5 ],
				[ -3, -3,  5 ] ];
				title = 'OPERADOR DE KIRSCH';
	} else if (key === 'b') { // Reducción de ruido
	matrixsize = 5;
	matrix = [ [  2/159,  4/159,    5/159,   4/159,  2/159 ],
				[  4/159,  9/159,   12/159,   9/159,  4/159 ],
				[  5/256,  12/256,  15/256,  12/256,  5/256 ],
				[  4/159,  9/159,   12/159,   9/159,  4/159 ],
				[  2/159,  4/159,    5/159,   4/159,  2/159 ] ];
				title = 'REDUCCIÓN DE RUIDO';
	} 
}
											</code>
										</pre>
										<!-- Pagination -->
										<div class="pagination">
											<a href="Software1.html" class="button-large">Previous Page</a>
											<a href="Software3.html" target="_parent" class="button-large">Next Page</a>
										</div>
									</section>
							</div>
						</div>
					</div>
				</section>

			<!-- Footer -->
				<section id="footer">
					<div class="container">
						<div class="row">
							<div class="col-8 col-12-medium">

								<!-- Links -->
									
									<section>
										<!--
										<h2>Links to Important Stuff</h2>
										<div>
											<div class="row">
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Neque amet dapibus</a></li>
														<li><a href="#">Sed mattis quis rutrum</a></li>
														<li><a href="#">Accumsan suspendisse</a></li>
														<li><a href="#">Eu varius vitae magna</a></li>
													</ul>
												</div>
											</div>
										</div>
										-->
									</section>

							</div>
							<div class="col-4 col-12-medium imp-medium">

								<!-- Blurb -->
									<section>
										<!--
										<h2>An Informative Text Blurb</h2>
										<p>
											Duis neque nisi, dapibus sed mattis quis, rutrum accumsan sed. Suspendisse eu
											varius nibh. Suspendisse vitae magna eget odio amet mollis. Duis neque nisi,
											dapibus sed mattis quis, sed rutrum accumsan sed. Suspendisse eu varius nibh
											lorem ipsum amet dolor sit amet lorem ipsum consequat gravida justo mollis.
										</p>
										-->
									</section>

							</div>
						</div>
					</div>
				</section>

			<!-- Copyright -->
				<div id="copyright">
					&copy; Untitled. All rights reserved. | Design: <a href="http://html5up.net">HTML5 UP</a>
				</div>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>